version: '3.8'

services:
  obsidian:
    build:
      context: .
      dockerfile: Dockerfile.dev
    container_name: bountyos-obsidian-dev
    network_mode: host
    environment:
      - HEADLESS=true
      - NO_UI=true
      - GITHUB_TOKEN=${GITHUB_TOKEN}
      - DISCORD_WEBHOOK_URL=${DISCORD_WEBHOOK_URL}
      - WEB_PORT=12496
      - LOG_TO_STDOUT=true
      - LOG_TO_STDERR=false
      - QUIET_UI_LOGS=true
      - VALIDATE_LINKS_HTTP=false
      - LINK_VALIDATION_TIMEOUT_SECONDS=5
      - WEB_STATIC_DIR=/app/web/dist
    volumes:
      - ./:/app
      - go_mod_cache:/go/pkg/mod
      - ./data:/app/data

  web:
    image: node:20-alpine
    container_name: bountyos-web-dev
    network_mode: host
    working_dir: /app/web
    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port 13440"
    environment:
      - VITE_API_TARGET=http://localhost:12496
      - VITE_WS_TARGET=ws://localhost:12496
    volumes:
      - ./web:/app/web
      - web_node_modules:/app/web/node_modules
    depends_on:
      - obsidian

volumes:
  go_mod_cache:
  web_node_modules:
